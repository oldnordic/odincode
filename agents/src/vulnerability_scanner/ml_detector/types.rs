//! ML Detector Types and Data Structures
//!
//! This module contains all data structures, enums, and type definitions
//! for the machine learning vulnerability detection system.

use std::collections::HashMap;

/// ML model type
#[derive(Debug, Clone, PartialEq)]
pub enum ModelType {
    /// Random Forest model
    RandomForest,
    /// Gradient Boosting model
    GradientBoosting,
    /// Neural Network model
    NeuralNetwork,
    /// Transformer-based model
    Transformer,
    /// Ensemble model (combination of multiple models)
    Ensemble,
}

/// ML model configuration
#[derive(Debug, Clone)]
pub struct ModelConfig {
    /// Model type
    pub model_type: ModelType,
    /// Model file path
    pub model_path: String,
    /// Feature extraction configuration
    pub feature_config: FeatureConfig,
    /// Prediction threshold
    pub threshold: f64,
    /// Model version
    pub version: String,
}

/// Feature extraction configuration
#[derive(Debug, Clone)]
pub struct FeatureConfig {
    /// Enable lexical features
    pub lexical_features: bool,
    /// Enable syntactic features
    pub syntactic_features: bool,
    /// Enable semantic features
    pub semantic_features: bool,
    /// Enable code metrics features
    pub code_metrics_features: bool,
    /// Enable data flow features
    pub data_flow_features: bool,
    /// Enable control flow features
    pub control_flow_features: bool,
}

/// Feature vector for ML prediction
#[derive(Debug, Clone)]
pub struct FeatureVector {
    /// Feature values
    pub values: Vec<f32>,
    /// Feature names
    pub names: Vec<String>,
    /// Feature importance scores
    pub importance: Vec<f32>,
}

/// ML prediction result
#[derive(Debug, Clone)]
pub struct PredictionResult {
    /// Predicted class (vulnerable or not)
    pub predicted_class: bool,
    /// Confidence score (0.0 to 1.0)
    pub confidence: f64,
    /// Class probabilities
    pub probabilities: HashMap<String, f64>,
    /// Feature importance scores
    pub feature_importance: HashMap<String, f32>,
    /// Model explanation
    pub explanation: String,
}

/// Language-specific feature extractor
pub struct LanguageFeatureExtractor {
    /// Programming language
    pub language: String,
    /// Supported feature types
    pub feature_types: Vec<String>,
    /// Feature extraction functions (thread-safe)
    pub extractors: HashMap<String, std::sync::Arc<dyn Fn(&str, &str) -> Vec<f32> + Send + Sync>>,
}
